<div class="container-fluid mt-3">
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h5 class="mb-0">Listado de Categorías</h5>
          <small class="text-muted">Gestión y mantenimiento</small>
        </div>
        <button class="btn btn-success" (click)="nuevo()">
          <i class="bi bi-plus-circle"></i> Nuevo
        </button>
      </div>
      <form [formGroup]="frmCategorias">
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Buscar categoría</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-search"></i>
              </span>
              <input
                class="form-control"
                formControlName="nombre"
                placeholder="Mínimo 2 caracteres"
              />
              <button class="btn btn-outline-secondary" type="button" (click)="limpiar()">
                <i class="bi bi-x-circle"></i>
              </button>
            </div>
          </div>
        </div>
      </form>
      @if (categoriasResource.isLoading()) {
        <div class="text-center py-4">
          <div class="spinner-border text-primary"></div>
        </div>
      }

      @if (!categoriasResource.isLoading() && categoriasPagina().length > 0) {
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>Nombre corto</th>
                <th>Nombre largo</th>
                <th>Estado</th>
                <th class="text-center">Acción</th>
              </tr>
            </thead>
            <tbody>
              @for (categoria of categoriasPagina(); track categoria.id) {
                <tr>
                  <td>{{ categoria.id }}</td>
                  <td>{{ categoria.nombreCorto }}</td>
                  <td>{{ categoria.nombreLargo }}</td>
                  <td>
                    <span
                      [ngClass]="categoria.estado === 'ACTIVO' ? 'badge bg-success' : 'badge bg-danger'"
                    >
                      {{ categoria.estado === 'ACTIVO' ? 'Activo' : 'Inactivo' }}
                    </span>
                  </td>
                  <td class="text-center">
                    <div class="btn-group btn-group-sm">
                      <button (click)="delete(categoria)" class="btn btn-danger">
                        <i class="bi bi-trash"></i>
                      </button>
                      <button (click)="verDetalle(categoria, template)" class="btn btn-warning">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button
                        class="btn btn-secondary"
                        [routerLink]="['/home/categorias/editar', categoria.id]"
                      >
                        <i class="bi bi-pencil"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }

      <div class="d-flex justify-content-center mt-3">
        <pagination
          [totalItems]="categoriasResource.value()?.length ?? 0"
          [itemsPerPage]="itemsPerPage"
          (pageChanged)="pageChanged($event)"
        >
        </pagination>
      </div>
    </div>
  </div>
</div>
<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Detalle de categorias - Id: {{ categoriaSelected()?.id }}</h4>
    <button
      type="button"
      class="btn-close close pull-right"
      aria-label="Close"
      (click)="modalRef?.hide()"
    >
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="card" style="width: 18rem">
      <div class="card-body">
        <h5 class="card-title">{{ categoriaSelected()?.nombreCorto }}</h5>
        <p class="card-text">
          {{ categoriaSelected()?.nombreLargo }}
        </p>
        <a href="#" class="btn btn-primary">Aplicar</a>
      </div>
    </div>
  </div>
</ng-template>
